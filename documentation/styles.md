# CSS organization and conventions style guide

---

## Introduction

Common styles for all eRegistrations system components are developed as part of _prototype_ project, which can be browsed at [proto.eregistrations.org](http://proto.eregistrations.org).

Prototype project provides base HTML/CSS foundation and all common interfaces for any eRegistrations system. It's provided in design agnostic manner, in form of tiny modules that can be used selectively in any eRegistrations system.

Below documentation describes how to configure markup and styles of eRegistrations system with existing modules, and also describes style guide rules up to which HTML and CSS modules were developed, and up to which future extensions or system specific components should be developed.

### How to adopt this work in eRegistrations system

When developing new (or migrating old) eRegistrations system, all configured views markup should precisely follow one in _prototype_.

In first place it's suggested to rely _strictly_ prototype styles, and do not proceed with system specific design until all markup is configured properly as in prototype, and application browses well with _prototype_ look.

After above is achieved and design for given system is ready, _theme_ should be applied on top of above work. Prototype doesn't force any specific design, so technically any design should be applicable to base foundation as provided by prototype.

It's likely that given eRegistrations system will introduce some custom components or will propose other version of interfaces for existing components. In such scenario, either new (or new version of) component should be introduced to prototype, or if it feels as specific to this single system, then it should be developed in system itself.

Below documentation provides all necessary details needed to accomplish successful adoption.

## CSS folders and files organization

All CSS is written and maintained in form of small modules, which then is bundled into browser ready files for configured applications.

### General filename conventions

All names of CSS files must be lowercase with tokens separated with dashes. Good: `foo-bar.css`, Bad: `fooBar.css`

### Location of prototype CSS modules

All CSS modules as introduced with Prototype, are placed in [/css](https://github.com/egovernment/eregistrations/tree/master/css) folder of eRegistrations project.

#### Base modules

Base foundation style files, can be found directly in `/css` folder:

* `base.css` - Reset and base system wide styles
* `form.css` - Styles related to form controls. It also contains all needed styles for form interfaces as generated by [dbjs dom](https://github.com/medikoo/dbjs-dom) bindings
* `table.css` - Base styles for tables
* `print-base.css` - Reset and base styles for print views
* `print-prototype-reset.css` - Temporary hack related to fact that at this point all print pages are also loaded with regular application css file. This files resets all eventual side effects of having application css file loaded.

#### Components

All other styles are organized as components, and can be found in [/css/components](https://github.com/egovernment/eregistrations/tree/master/css/components) folder.

Some of the components are documented in below part of this documentation. For those not documented, their purpose with styles and markup should be self explanatory.

#### Legacy degradation modules

There's also [/css/legacy](https://github.com/egovernment/eregistrations/tree/master/css/legacy) folder which contains all eventual _degradation_ rules which apply __only__ to legacy browsers (ones that are served with static version of pages and not single page application program). It applies to IE10 and lower, IE mobile, and some very old versions of other engines.

Idea behind degradation rules: e.g. if there's a component styled normally with flexbox, that is not supported in older IE engines. Then in legacy folder we may create corresponding component file (it's name and location must exactly reflect location within `/css` folder) that provides alternative fixed rules for this component, so given part of interface remain functional and accessible in outdated engine as well.

### Location of eRegistrations system specific CSS modules

Same as in case of prototype, they should be placed in `/css` folder of project, e.g. see [/css](https://github.com/egovernment/eregistrations-salvador/tree/master/css) folder of ELS eRegistrations project.

What should land here is usually _theme_ styles that apply specific system design, and eventual system specific components.

In [ELS project](https://github.com/egovernment/eregistrations-salvador/tree/master/css) three different theme files were created to differentiate between public, part A, and part B applications. There's also base `theme.css` files that's included in all cases. This organization should also work well for any other eRegistrations system.

Same here, any eventual legacy _degradation_ rules should be placed in corresponding files within `/css/legacy` folder. 

## CSS modules bundle configuration

### Application modules bundle

For any application within eRegistrations system (where application is e.g. `public`, `user`, `user-submitted`) one major CSS bundle is created that includes css code for all used components.

Content of a bundle is configured per application, and takes place in `css.index` file placed in `client` folder of application. See e.g. [css.index](https://github.com/egovernment/eregistrations-salvador/blob/master/user/client/css.index) configuration for _user_ application of ELS system.

In index all files that should be concatenated into result bundle should be listed in desired order.

Creation of index file, is __all__ what needs to be done for bundle to be generated automatically by the framework.

To have generated CSS file loaded with application, it needs to be included in `index.html` file of application, which is placed in `view/{applicationName}` folder. Bundle name automatically reflects application name, so e.g. for _user_ application it'll be `user.css`. See e.g. css bundle linked within [index.html](https://github.com/egovernment/eregistrations-salvador/blob/master/view/user/index.html#L28) for _user_ application of ELS system.

### Print modules bundle

Exactly same way css index should be configured for print pages. In this case index is named `css-print.index` , see e.g. [css-print.index](https://github.com/egovernment/eregistrations-salvador/blob/master/user/client/css-print.index) configuration for _user_ application of ELS system.

As with major index file, generated CSS needs to be linked within application manually. However as this time we don't want to have print styles loaded for regular pages, we reference it directly within configured print views, as e.g. it's done in this [print view](https://github.com/egovernment/eregistrations-salvador/blob/master/view/user/imprimir-costos.js#L25) of ELS project.

### Legacy modules bundle

There's no additional work needed to assure that legacy _degradation_ rules are loaded for legacy engines. Bundle is generated automatically on basis of main `css.index` and CSS bundle file is linked automatically in html via static pages generator.

However, what's important, there's no special legacy handling configured for print views. Those views resemble very simple layout structures and should be styled by default as accessible also in old engines.

## CSS style guide

### No ID's in selectors

Id's specificity weight is very high therefore we decided not to rely on them.
If id's appear in markup their usage is reserved strictly for JS needs.

### Class naming conventions

All introduced class names must be lowercase, with tokens separated with dashes. Good: `foo-bar`, Bad: `fooBar`, `foo_bar`

When deciding on new class names we take functional semantic approach, and not presentational. e.g.
* Good `sidebar`, Bad: `column-2`. 
* Good `error-message`, Bad: `red-box`

Whenever you'll introduce new class names, it'll be either cause of new component is introduced, or you customise existing component with additional class. Technically there should be no other case, if you think you approached one, please consult with other colleagues first.

When classifying components we follow some [BEM conventions](http://csswizardry.com/2013/01/mindbemding-getting-your-head-round-bem-syntax/). While we do not follow it's sophisticated class naming rules, we keep to the idea that all dependent sub component/state classes should be prefixed with main component name, and just by this single class referred further in CSS selectors.

e.g. we have [steps menu](http://proto.eregistrations.org/guide/) component that's displayed in user interface which is visible after user registers to the system. It is named: `user-steps-menu`, it becomes both, name of the class for the component and also the name of a CSS file which contains related rules.

Internally all sub component/state classes, are prefixed with `users-steps-menu`, e.g. `users-steps-menu-wrapper`, `users-steps-menu-start-step`. Same logic should be maintained when updating or introducing new components.

### Minimal selectors

Selectors introduced in CSS files, must remain as minimal as possible.

### Graceful degradation, no old school hacks

__In first place we style for modern engines, no look backs.__

It's not allowed to use `float` hacks to compose layout. Instead rely on [flexbox](https://developer.mozilla.org/en-US/docs/Web/Guide/CSS/Flexible_boxes) or `display: inline-block`, or `display: table`. If you need rounded corners, rely strictly on `border-radius`, for gradients, use dedicated background properties. All of this features are already supported in all latest versions of major engines.

#### Handling older engines

We want to support old engines as far as IE8. Still, it's only about making the application usable and fully functional, we do not strive to make it look exactly same as on modern engine.

To introduce necessary tweaks to old engines, we configured mechanism that allows to add _degradation_ rules for components for which regular styles break layout in old engines. See _Legacy degradation modules_ and _Legacy modules bundle_ sections to see how to apply them. Over there it's allowed to rely on `float` if needed. Still it needs to be minimal, and should be strictly about addressing layout or significant usability breakages. Do not try to try to make round corners for IE, or introduce other not natively supported sugar for this engines.

### Other important rules guarded with lint utility

CSS code is validated with [CSS lint](https://github.com/medikoo/csslint-next#csslint-next) utility.
It checks the code against most of [preconfigured rules](https://github.com/CSSLint/csslint/wiki/Rules) and some [whitespace rules](https://github.com/medikoo/csslint-next#additional-rules) added by us.

We had reasons to opt out of some rules, list of it can be found in project [.lint](https://github.com/egovernment/eregistrations/blob/master/.lint#L5-L11) configuration.

Every eRegistrations system should have [CSS lint tasks](https://github.com/egovernment/eregistrations/blob/master/package.json#L37-L39) configured, and eventual CSS lint cofiguration added to `.lint` files.

### Dealing with vendor prefixes

There's the [Autoprefixer](https://github.com/postcss/autoprefixer) utility configured with the bundler. So it's fine to use only standard names in CSS files, they will be automatically resolved to all needed vendor prefixes.

### CSS Variables

CSS variables are used to address common colors or dimension settings that repeat across rules.
They're resolution is configured within a bundler with help of [css-aid](https://github.com/medikoo/css-aid#variables) utility

### Vertical Rhythm

All page layouts are composed with respect to vertical rhythm. More information on VR can be found in this [article](http://24ways.org/2006/compose-to-a-vertical-rhythm/).  

Base line height of our VR setup is __22px__

In development we confirm VR with help of browser extensions, e.g. GridFox on Firefox or PixelPerfect for Chrome (for this use [grid-22.png](https://github.com/egovernment/eregistrations/blob/master/css/grid-22.png) image)

It's allowed to introduce small exceptions to the rule (e.g. show input hint closer to input box), but overall vertical rhythm of a page must remain maintained.

It's also ok, to ignore eventual browser bugs which cause small deviations from vertical rhythm. Still for Google Chrome and Mozilla Firefox browsers we strive for _perfection_.

### Responsiveness

At this point eRegistrations application layout is configured for both desktop and mobile views. Switch to mobile version occurs when screen resolution is less than 640px.

Styles specific to mobile view, can be applied via [media-queries](https://github.com/egovernment/eregistrations/blob/e18d7068362e6109923871f49c6079ee396e7b60/css/form.css#L455).

Minimum mobile resolution is set to 320px.

Control of responsive display is mostly done by changing _flex-wrap_ property set to *wrap* in mobile view. 

Example can be found [here](https://github.com/egovernment/eregistrations/blob/master/css/components/container-with-nav.css#L36-L39).

### Browsers we support

We support all major engines (Chrome, Firefox, Safari, IE, Opera) on both desktop and mobile in their latest versions. Via additional legacy degradation styles we maintain application as fully usable and functional for all engines which can't run application in SPA mode. Our support goes lowest to IE8 browser.

## Components

Below is list of notes for some components for which we felt some additional documentation is needed.
For all others markup and styles should be self explanatory.

### Responsive tables

Responsive table flips its header to be first column for every row of table. From the code perspective, this can be achieved simply by adding property `responsive: true` on a table. 

Example can be found [here](https://github.com/egovernment/eregistrations/blob/master/view/prototype/user-submitted.js#L39) 

### Font icons

**Font Awesome** is used in eRegistrations for icons. Only icons that we actually use are configured. Any new icons need to be added to icons file: *css/components/fa.css*.

**Adding new icon** can be made by selecting new icon from [this list](https://fortawesome.github.io/Font-Awesome/cheatsheet/) and adding class for this font in *css/components/fa.css*  

**Example** - adding *automobile icon* requires adding its class and :before pseudo-element:

```
.fa-automobile {
	width: 1.2em;
}
.fa-automobile:before {
	content: "\f1b9";
}
```
Then in templates a element need to be added:

```
span({ class: 'fa fa-automobile' }, "Car")
```
"Car" text will not be shown when CSS is applied.

### Tooltips (optional hints)

Tooltips are small, black, popup windows that are displayed on hover over significant element. 
Our component is developed on top of vendor library - [hint.css](http://kushagragour.in/lab/hint/).

Any element which needs to have a tooltip has to be given ***hint-optional*** class. To position hint, at least one of the position classes need to be added:  

***hint-optional-top***,  
***hint-optional-bottom***,  
***hint-optional-left***,  
***hint-optional-right***  
  
The ***tooltip text*** has to be given using the ***data-hint attribute*** on that 
element.

Example can be found [here](https://github.com/egovernment/eregistrations/blob/master/view/prototype/user-submitted.js#L56-L58).

```
span({ class: 'hint-optional hint-optional-left', 
		'data-hint': "Lorem ipsum dolor sit amet" },
	"Lorem ipsum"
	);

```

### Freeform text

It's the component we use, where we inject multi-paragraph i18n messages with markdown support.

It provides sensible styles to lists, paragraphs etc. for such scenario.

Example can be found [here](https://github.com/egovernment/eregistrations-salvador/blob/a36fa4fb7b4bcf229bb70121ee6221fb0907dd02/view/company/index.js#L275).

### Disabler

Disabler is a component, that can cover all other components under partially transparent background, and make all of them not clickable

Disabler requires a wrapper component, containing all  elements that should be disabled. This wrapper component needs to have ***disabler-range*** class.  

Disabler requires empty ***div*** with ***disabler*** class, as first line last child element. 

Example can be found [here](https://github.com/egovernment/eregistrations/blob/master/view/prototype/documents.js#L11-L34).

For turning on disabler, a ***disabler-active*** class needs to be added to ***disabler-range*** component. 

Example can be found [here](https://github.com/egovernment/eregistrations/blob/master/view/prototype/disabled-documents.js#L5).

```
div({ class: 'disabler-range' },
	"Lorem ipsum to be disabled",
	
	div({ class: 'disabler' })
);

```
